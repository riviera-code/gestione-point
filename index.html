<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bordighera Domani - Gestione Point</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel per JSX nel browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getFirestore, collection, doc, setDoc, addDoc, deleteDoc, 
            updateDoc, onSnapshot, serverTimestamp, query 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const { useState, useEffect, useMemo } = React;

        const Icons = {
            Plus: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            ),
            CheckCircle: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            ),
            XCircle: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
            ),
            Loader2: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
            ),
            ChevronLeft: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
            ),
            ChevronRight: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
            ),
            X: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            ),
            History: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"></path><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path></svg>
            ),
            Trash2: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
            ),
            Edit2: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
            ),
            AlertTriangle: ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            )
        };

        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : {
                apiKey: "", 
                authDomain: "",
                projectId: "",
                storageBucket: "",
                messagingSenderId: "",
                appId: ""
            };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'bordighera-domani-point';

        const START_HOUR = 7;
        const END_HOUR = 20;

        const TIME_OPTIONS = [];
        for (let h = START_HOUR; h <= END_HOUR; h++) {
            const hour = h.toString().padStart(2, '0');
            TIME_OPTIONS.push(`${hour}:00`);
            if (h < END_HOUR) TIME_OPTIONS.push(`${hour}:30`);
        }

        const INITIAL_COLLABORATORS = [
            "ALBANESE A.", "BALDASSARRE M.", "BASSI M.", "BERTAINA F.", "BONAVIA B.", 
            "BOZZARELLI M.", "DEBENEDETTI F.", "DI VITO M.", "GAZZANO G.", 
            "GUGLIELMI P.", "MANZONI A.", "MARIELLA M.", "MERLO A.", 
            "PIANTONI S.", "SCARINGELLA W.", "SILVESTRI S.", "TRUCCHI G.", "ZAGNI M."
        ].sort();

        const HOURS_GRID = [];
        for (let h = START_HOUR; h < END_HOUR; h++) {
            HOURS_GRID.push(`${h.toString().padStart(2, '0')}:00`);
        }

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [shifts, setShifts] = useState([]);
            const [dbVolunteers, setDbVolunteers] = useState([]);
            const [isPointOpen, setIsPointOpen] = useState(false);
            const [modalMode, setModalMode] = useState(null);
            const [selectedVolunteer, setSelectedVolunteer] = useState(null);
            const [notification, setNotification] = useState(null);
            const [editingShift, setEditingShift] = useState(null);
            const [newVolunteerInput, setNewVolunteerInput] = useState('');
            
            const [currentWeekStart, setCurrentWeekStart] = useState(() => {
                const d = new Date();
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1); 
                return new Date(d.setDate(diff));
            });

            const [formData, setFormData] = useState({
                mode: 'single',
                date: new Date().toISOString().split('T')[0],
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date().toISOString().split('T')[0],
                startTime: '09:00',
                endTime: '12:00'
            });

            const allVolunteers = useMemo(() => {
                const combined = [...new Set([...INITIAL_COLLABORATORS, ...dbVolunteers])];
                return combined.sort();
            }, [dbVolunteers]);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) { 
                        console.error("Auth Error:", error); 
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                
                const shiftsCol = collection(db, 'artifacts', appId, 'public', 'data', 'shifts');
                const unsubShifts = onSnapshot(shiftsCol, (snap) => {
                    setShifts(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                }, (err) => console.error("Snapshot error:", err));

                const volCol = collection(db, 'artifacts', appId, 'public', 'data', 'volunteers');
                const unsubVols = onSnapshot(volCol, (snap) => {
                    setDbVolunteers(snap.docs.map(d => d.data().name).filter(n => !!n));
                }, (err) => console.error("Snapshot error:", err));

                const statusDoc = doc(db, 'artifacts', appId, 'public', 'data', 'status', 'current');
                const unsubStatus = onSnapshot(statusDoc, (snap) => {
                    if (snap.exists()) setIsPointOpen(snap.data().isOpen);
                }, (err) => console.error("Snapshot error:", err));

                return () => { unsubShifts(); unsubVols(); unsubStatus(); };
            }, [user]);

            const weekDays = useMemo(() => {
                return Array.from({ length: 7 }, (_, i) => {
                    const d = new Date(currentWeekStart);
                    d.setDate(d.getDate() + i);
                    return d;
                });
            }, [currentWeekStart]);

            const getPresencesForHour = (dateStr, hourStartStr) => {
                const hourInt = parseInt(hourStartStr.split(':')[0]);
                const hourEndStr = `${(hourInt + 1).toString().padStart(2, '0')}:00`;
                return shifts.filter(s => s.date === dateStr && s.startTime < hourEndStr && s.endTime > hourStartStr);
            };

            const showMsg = (text, type = 'info') => {
                setNotification({ text, type });
                setTimeout(() => setNotification(null), 4000);
            };

            const handleSaveShift = async () => {
                if (!selectedVolunteer) {
                    showMsg("Identificati prima di salvare.", "warning");
                    return;
                }
                if (!user) {
                    showMsg("Connessione al database non pronta.", "warning");
                    return;
                }
                if (formData.endTime <= formData.startTime) {
                    showMsg("L'orario di fine deve essere dopo l'inizio.", "warning");
                    return;
                }

                setSaving(true);
                try {
                    const shiftsCol = collection(db, 'artifacts', appId, 'public', 'data', 'shifts');
                    
                    if (!INITIAL_COLLABORATORS.includes(selectedVolunteer) && !dbVolunteers.includes(selectedVolunteer)) {
                        const volRef = doc(db, 'artifacts', appId, 'public', 'data', 'volunteers', selectedVolunteer.replace(/\s+/g, '_').toLowerCase());
                        await setDoc(volRef, { name: selectedVolunteer });
                    }

                    let datesToSave = [];
                    if (formData.mode === 'single') {
                        datesToSave.push(formData.date);
                    } else if (formData.mode === 'current_week' || formData.mode === 'next_week') {
                        const d = new Date();
                        const day = d.getDay();
                        const diff = d.getDate() - day + (day === 0 ? -6 : 1) + (formData.mode === 'next_week' ? 7 : 0);
                        const monday = new Date(d.setDate(diff));
                        for (let i = 0; i < 7; i++) {
                            const date = new Date(monday);
                            date.setDate(date.getDate() + i);
                            datesToSave.push(date.toISOString().split('T')[0]);
                        }
                    } else if (formData.mode === 'range') {
                        let start = new Date(formData.startDate);
                        const end = new Date(formData.endDate);
                        while (start <= end) {
                            datesToSave.push(new Date(start).toISOString().split('T')[0]);
                            start.setDate(start.getDate() + 1);
                        }
                    }

                    if (editingShift) {
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shifts', editingShift.id), {
                            date: formData.date,
                            startTime: formData.startTime,
                            endTime: formData.endTime,
                            updatedAt: serverTimestamp()
                        });
                        showMsg("Turno aggiornato con successo!", "success");
                    } else {
                        for (const d of datesToSave) {
                            const isDuplicate = shifts.some(s => s.volunteerName === selectedVolunteer && s.date === d && s.startTime === formData.startTime && s.endTime === formData.endTime);
                            if (!isDuplicate) {
                                await addDoc(shiftsCol, {
                                    date: d,
                                    startTime: formData.startTime,
                                    endTime: formData.endTime,
                                    volunteerName: selectedVolunteer,
                                    createdAt: serverTimestamp()
                                });
                            }
                        }
                        showMsg("Orario salvato correttamente!", "success");
                    }
                    setModalMode('dashboard');
                    setEditingShift(null);
                } catch (e) { 
                    console.error(e); 
                    showMsg("Errore durante il salvataggio. Riprova.", "warning");
                } finally {
                    setSaving(false);
                }
            };

            const deleteShift = async (id) => {
                if (!user) return;
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shifts', id));
                    showMsg("Turno rimosso.", "success");
                } catch (e) { console.error(e); }
            };

            const startEditShift = (shift) => {
                setEditingShift(shift);
                setFormData({
                    ...formData,
                    mode: 'single',
                    date: shift.date,
                    startTime: shift.startTime,
                    endTime: shift.endTime
                });
                setModalMode('form');
            };

            const navigateWeek = (weeks) => {
                setCurrentWeekStart(prev => {
                    const next = new Date(prev);
                    next.setDate(next.getDate() + (weeks * 7));
                    return next;
                });
            };

            if (loading) return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-white text-blue-600">
                    <Icons.Loader2 size={40} className="animate-spin" />
                </div>
            );

            return (
                <div className="min-h-screen pb-20">
                    {notification && (
                        <div className={`fixed top-24 left-1/2 -translate-x-1/2 z-[200] px-6 py-4 rounded-3xl shadow-2xl flex items-center gap-4 animate-bounce border-2 ${
                            notification.type === 'success' ? 'bg-green-600 border-green-400 text-white' : 'bg-amber-500 border-amber-300 text-white'
                        }`}>
                            {notification.type === 'warning' ? <Icons.AlertTriangle size={24} /> : <Icons.CheckCircle size={24} />}
                            <span className="font-black text-sm uppercase tracking-tight">{notification.text}</span>
                        </div>
                    )}

                    <header className="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                <img src="https://bordigheradomani.it/img/logo.png" alt="Logo" className="h-12" />
                                <div className="hidden sm:block">
                                    <h1 className="text-lg font-black text-blue-900 leading-none">Gestione Point</h1>
                                    <p className="text-[10px] uppercase tracking-widest text-slate-400 font-black">Lista Civica</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <button onClick={() => setModalMode('identity')} className="bg-blue-600 text-white px-5 py-3 rounded-2xl font-black text-sm shadow-xl hover:bg-blue-700 flex items-center gap-2 active:scale-95 transition-all">
                                    <Icons.Plus size={16} /> <span>Aggiungi Disponibilità</span>
                                </button>
                                <div className={`h-12 w-12 rounded-full flex items-center justify-center border-2 cursor-pointer shadow-sm transition-all ${isPointOpen ? 'bg-green-50 border-green-500 text-green-600' : 'bg-red-50 border-red-500 text-red-600'}`} onClick={async () => {
                                    if (!user) return;
                                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'status', 'current'), { isOpen: !isPointOpen, updatedAt: serverTimestamp() }, { merge: true });
                                }}>
                                    {isPointOpen ? <Icons.CheckCircle size={24} /> : <Icons.XCircle size={24} />}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-6 space-y-6">
                        <div className="flex items-center justify-center gap-4 bg-white p-3 rounded-2xl border border-slate-200 shadow-sm max-w-md mx-auto">
                            <button onClick={() => navigateWeek(-1)} className="p-2 hover:bg-slate-100 rounded-xl text-slate-400"><Icons.ChevronLeft /></button>
                            <div className="flex-1 text-center min-w-[180px]">
                                <p className="font-black text-blue-900 text-sm uppercase">
                                    {weekDays[0].toLocaleDateString('it-IT', { day: 'numeric', month: 'short' })} - {weekDays[6].toLocaleDateString('it-IT', { day: 'numeric', month: 'short' })}
                                </p>
                            </div>
                            <button onClick={() => navigateWeek(1)} className="p-2 hover:bg-slate-100 rounded-xl text-slate-400"><Icons.ChevronRight /></button>
                        </div>

                        <div className="bg-white rounded-[40px] border border-slate-100 shadow-2xl overflow-hidden">
                            <div className="overflow-x-auto custom-scrollbar">
                                <div className="min-w-[900px]">
                                    <div className="grid grid-cols-[80px_repeat(7,1fr)] bg-white sticky top-0 z-10 border-b border-slate-100 font-bold">
                                        <div className="p-4"></div>
                                        {weekDays.map((day, i) => (
                                            <div key={i} className="p-4 text-center">
                                                <p className="text-[10px] uppercase font-black tracking-widest text-blue-400">
                                                    {day.toLocaleDateString('it-IT', { weekday: 'short' })}
                                                </p>
                                                <p className="text-xl font-black text-blue-600">{day.getDate()}</p>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex flex-col">
                                        {HOURS_GRID.map((hourSlot) => (
                                            <div key={hourSlot} className="grid grid-cols-[80px_repeat(7,1fr)] border-b border-slate-50 min-h-[85px]">
                                                <div className="flex items-center justify-center text-[11px] font-black text-slate-300 p-4">{hourSlot}</div>
                                                {weekDays.map((day, dayIdx) => {
                                                    const dateStr = day.toISOString().split('T')[0];
                                                    const activeShifts = getPresencesForHour(dateStr, hourSlot);
                                                    const isOverlap = activeShifts.length > 1;
                                                    const hasPresence = activeShifts.length > 0;
                                                    return (
                                                        <div key={dayIdx} className={`p-1.5 flex items-center justify-center border-l border-slate-50`}>
                                                            {hasPresence && (
                                                                <div className={`w-full h-full rounded-[22px] flex flex-col items-center justify-center text-center p-2 shadow-sm transition-all hover:scale-[1.02] ${isOverlap ? 'bg-orange-500 text-white' : 'bg-blue-600 text-white'}`}>
                                                                    {activeShifts.map((s) => (
                                                                        <div key={s.id} className="w-full">
                                                                            <p className="text-[10px] font-black uppercase tracking-tighter leading-tight">{s.volunteerName}</p>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    {modalMode && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/70 backdrop-blur-md">
                            <div className="bg-white w-full max-w-2xl rounded-[48px] shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200">
                                <button onClick={() => setModalMode(null)} className="absolute right-8 top-8 p-3 text-slate-300 hover:text-slate-600 transition-colors z-[110]"><Icons.X size={32} /></button>
                                
                                {modalMode === 'identity' && (
                                    <div className="p-8 md:p-14 overflow-y-auto">
                                        <h3 className="text-3xl font-black text-blue-900 uppercase italic text-center mb-10 tracking-tight">Chi sta operando?</h3>
                                        <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-12">
                                            {allVolunteers.map(v => (
                                                <button key={v} onClick={() => { setSelectedVolunteer(v); setModalMode('dashboard'); }} className="p-4 text-center rounded-[24px] border border-slate-100 hover:bg-blue-600 hover:text-white font-black text-[13px] text-slate-800 shadow-sm transition-all">{v}</button>
                                            ))}
                                        </div>
                                        <div className="bg-slate-50 p-8 rounded-[40px] flex flex-col gap-4 border border-slate-100">
                                            <p className="text-[10px] font-black uppercase text-slate-400 ml-4 tracking-widest">Aggiungi Nuovo Collaboratore</p>
                                            <div className="flex gap-3">
                                                <input type="text" placeholder="NOME E COGNOME" className="flex-1 px-6 py-5 rounded-2xl border-2 border-slate-200 outline-none font-bold text-slate-700 bg-white focus:border-blue-500 transition-all" value={newVolunteerInput} onChange={(e) => setNewVolunteerInput(e.target.value.toUpperCase())} />
                                                <button disabled={!newVolunteerInput} onClick={() => { setSelectedVolunteer(newVolunteerInput); setModalMode('dashboard'); }} className="bg-blue-600 text-white px-8 rounded-2xl font-black disabled:opacity-30 uppercase">VAI</button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {modalMode === 'dashboard' && (
                                    <div className="p-14 flex flex-col items-center gap-10 text-center">
                                        <div className="space-y-2">
                                            <p className="text-slate-400 font-black uppercase text-[10px] tracking-[0.2em]">Pannello di</p>
                                            <h3 className="text-5xl font-black text-blue-900 uppercase italic tracking-tighter">{selectedVolunteer}</h3>
                                        </div>
                                        <div className="w-full space-y-5">
                                            <button onClick={() => { setEditingShift(null); setModalMode('form'); }} className="w-full bg-blue-600 text-white p-10 rounded-[40px] flex items-center gap-8 shadow-2xl hover:bg-blue-700 transition-all active:scale-95 text-left group">
                                                <div className="bg-white/20 p-5 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Plus size={32} /></div>
                                                <div><p className="text-xl font-black uppercase tracking-tight">Inserisci Disponibilità</p><p className="text-sm opacity-70 font-bold uppercase tracking-widest">Pianifica nuovi turni</p></div>
                                            </button>
                                            <button onClick={() => setModalMode('manage')} className="w-full bg-[#0d121f] text-white p-10 rounded-[40px] flex items-center gap-8 shadow-2xl hover:bg-slate-800 transition-all active:scale-95 text-left group">
                                                <div className="bg-white/10 p-5 rounded-2xl group-hover:scale-110 transition-transform"><Icons.History size={32} /></div>
                                                <div><p className="text-xl font-black uppercase tracking-tight">I miei turni</p><p className="text-sm opacity-50 font-bold uppercase tracking-widest">Modifica o elimina</p></div>
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {modalMode === 'form' && (
                                    <div className="p-10 md:p-14 overflow-y-auto space-y-10">
                                        <div className="space-y-2">
                                            <h3 className="text-3xl font-black text-blue-900 uppercase italic tracking-tight">Nuova Pianificazione</h3>
                                            <p className="text-slate-400 font-bold text-xs uppercase">Scegli come inserire la tua presenza</p>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4">
                                            {[
                                                { id: 'single', label: 'Singolo Giorno' }, 
                                                { id: 'current_week', label: 'Tutta la Settimana' }, 
                                                { id: 'next_week', label: 'Settimana Prossima' }, 
                                                { id: 'range', label: 'Periodo' }
                                            ].map(m => (
                                                <button key={m.id} onClick={() => setFormData({...formData, mode: m.id})} className={`p-5 rounded-[24px] border-2 font-black text-[11px] uppercase tracking-tighter transition-all ${formData.mode === m.id ? 'border-blue-600 bg-blue-600 text-white shadow-lg' : 'border-slate-50 bg-slate-50/50 text-slate-400 hover:border-slate-200'}`}>
                                                    {m.label}
                                                </button>
                                            ))}
                                        </div>

                                        <div className="space-y-6">
                                            {(formData.mode === 'single' || editingShift) && (
                                                <div className="space-y-2">
                                                    <label className="text-[10px] font-black uppercase text-slate-400 ml-4">Data Selezionata</label>
                                                    <input type="date" className="w-full p-6 rounded-3xl border-2 border-slate-100 font-bold text-blue-900 text-xl bg-slate-50 focus:bg-white transition-all outline-none" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} />
                                                </div>
                                            )}
                                            {formData.mode === 'range' && (
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="space-y-2">
                                                        <label className="text-[10px] font-black uppercase text-slate-400 ml-4">Inizio</label>
                                                        <input type="date" className="w-full p-5 rounded-2xl border-2 border-slate-100 font-bold text-blue-900" value={formData.startDate} onChange={e => setFormData({...formData, startDate: e.target.value})} />
                                                    </div>
                                                    <div className="space-y-2">
                                                        <label className="text-[10px] font-black uppercase text-slate-400 ml-4">Fine</label>
                                                        <input type="date" className="w-full p-5 rounded-2xl border-2 border-slate-100 font-bold text-blue-900" value={formData.endDate} onChange={e => setFormData({...formData, endDate: e.target.value})} />
                                                    </div>
                                                </div>
                                            )}
                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="space-y-2">
                                                    <label className="text-[10px] font-black uppercase text-slate-400 ml-4">Dalle Ore</label>
                                                    <select className="w-full p-6 rounded-3xl border-2 border-slate-100 font-black text-2xl text-blue-900 bg-slate-50 appearance-none text-center outline-none" value={formData.startTime} onChange={e => setFormData({...formData, startTime: e.target.value})}>
                                                        {TIME_OPTIONS.map(o => <option key={o} value={o}>{o}</option>)}
                                                    </select>
                                                </div>
                                                <div className="space-y-2">
                                                    <label className="text-[10px] font-black uppercase text-slate-400 ml-4">Alle Ore</label>
                                                    <select className="w-full p-6 rounded-3xl border-2 border-slate-100 font-black text-2xl text-blue-900 bg-slate-50 appearance-none text-center outline-none" value={formData.endTime} onChange={e => setFormData({...formData, endTime: e.target.value})}>
                                                        {TIME_OPTIONS.map(o => <option key={o} value={o}>{o}</option>)}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex gap-4 pt-4">
                                            <button onClick={() => setModalMode('dashboard')} className="flex-1 font-black text-slate-300 uppercase tracking-widest text-xs py-6">INDIETRO</button>
                                            <button 
                                                disabled={saving}
                                                onClick={handleSaveShift} 
                                                className="flex-[2] bg-green-600 text-white py-6 rounded-3xl font-black uppercase tracking-widest shadow-xl shadow-green-100 hover:bg-green-700 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-50"
                                            >
                                                {saving ? <Icons.Loader2 className="animate-spin" /> : null}
                                                {editingShift ? 'AGGIORNA' : 'CONFERMA'}
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {modalMode === 'manage' && (
                                    <div className="p-10 md:p-14 flex flex-col h-full overflow-hidden">
                                        <div className="flex justify-between items-center mb-8">
                                            <h3 className="text-2xl font-black text-blue-900 uppercase italic">I Tuoi Turni</h3>
                                            <button onClick={() => setModalMode('dashboard')} className="bg-slate-100 px-6 py-2 rounded-full font-black text-[10px] uppercase">CHIUDI</button>
                                        </div>
                                        <div className="flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar">
                                            {shifts.filter(s => s.volunteerName === selectedVolunteer).length === 0 ? (
                                                <div className="flex flex-col items-center justify-center py-20 text-slate-200">
                                                    <Icons.History size={64} className="mb-4 opacity-10" />
                                                    <p className="font-bold italic">Nessun turno trovato nel database.</p>
                                                </div>
                                            ) : (
                                                shifts.filter(s => s.volunteerName === selectedVolunteer).sort((a,b) => b.date.localeCompare(a.date)).map(s => (
                                                    <div key={s.id} className="bg-slate-50 p-6 rounded-[32px] flex items-center justify-between border border-slate-100 hover:bg-white hover:shadow-lg transition-all">
                                                        <div className="flex items-center gap-6">
                                                            <div className="bg-blue-600 text-white p-3 rounded-2xl text-center min-w-[60px] shadow-lg shadow-blue-100">
                                                                <p className="text-[10px] font-bold leading-none uppercase">{new Date(s.date).toLocaleDateString('it-IT', { weekday: 'short' })}</p>
                                                                <p className="text-xl font-black">{new Date(s.date).getDate()}</p>
                                                            </div>
                                                            <div>
                                                                <p className="text-lg font-black text-slate-800 leading-tight">{s.startTime} — {s.endTime}</p>
                                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">{new Date(s.date).toLocaleDateString('it-IT', { month: 'long', year: 'numeric' })}</p>
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => startEditShift(s)} className="p-3 text-blue-600 hover:bg-blue-100 rounded-xl transition-colors"><Icons.Edit2 size={20} /></button>
                                                            <button onClick={() => deleteShift(s.id)} className="p-3 text-red-600 hover:bg-red-100 rounded-xl transition-colors"><Icons.Trash2 size={20} /></button>
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <footer className="max-w-7xl mx-auto px-4 mt-12 text-center text-slate-300 text-[10px] py-12 border-t border-slate-200 uppercase tracking-[0.3em] font-black">
                        <p>Bordighera Domani - Sistema Point 2024</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
